import{u as H,r as c,g as J,h as E,c as i,a as t,i as d,t as b,b as S,d as V,w as N,v as O,n as x,F as B,j as K,e as Q,o as u,f as W,k}from"./index-CGQ7toY1.js";import{S as m,a as p}from"./sweetalert2.esm.all-DYEfS7jK.js";const X=(w,y)=>{const n=w.__vccOpts||w;for(const[v,l]of y)n[v]=l;return n},Y={id:"todoListPage",class:"bg-half"},Z={class:"todo_sm"},ee={class:"conatiner todoListPage vhContainer"},te={class:"todoList_Content"},se={class:"inputBox"},ae={class:"todoList_list"},oe={class:"todoList_tab"},le={class:"todoList_items"},ne={class:"todoList_item"},ie={class:"todoList_label"},ue=["checked","onChange"],re=["onUpdate:modelValue"],ce={href:"#"},de=["onClick"],ve=["onClick"],fe={href:"#"},pe=["onClick"],he=["onClick"],_e={key:1,class:"todoList_label"},ke={class:"todoList_statistics"},h="https://todolist-api.hexschool.io",me={__name:"TodolistPage",setup(w){const y=H(),n=c([]),v=c(""),l=c({}),r=c(""),z=c({uid:"",nickname:""});J(async()=>{r.value=document.cookie.replace(/(?:(?:^|.*;\s*)customTodoToken\s*=\s*([^;]*).*$)|^.*$/,"$1"),r.value||(m.fire({icon:"error",title:"沒token(´･Д･)」"}),y.push("/"));try{const e=await p.get(`${h}/users/checkout`,{headers:{Authorization:r.value}});z.value=e.data,g()}catch{m.fire({icon:"error",title:"驗證失效(´･Д･)」"}),y.push("/")}});const g=async()=>{try{const e=await p.get(`${h}/todos`,{headers:{Authorization:r.value}});n.value=e.data.data}catch{m.fire({icon:"error",title:"取得TodoList失敗(´･Д･)」"})}},P=async()=>{if(!v.value){m.fire({icon:"error",title:"待辦事項不可空白(´･Д･)」"});return}const e={content:v.value};await p.post(`${h}/todos`,e,{headers:{Authorization:r.value}}),v.value="",g()},j=async e=>{await p.delete(`${h}/todos/${e}`,{headers:{Authorization:r.value}}),g()},o=c({}),$=c({}),D=(e,s)=>{o.value={...o.value,[e]:!0},$.value={...$.value,[e]:s},l.value={...l.value,[e]:s}},I=async e=>{const s=l.value[e];s!==$.value[e]&&await M(e,s),o.value={...o.value,[e]:!1}},M=async(e,s)=>{const C=n.value.find(a=>a.id===e);C.content=s,await p.put(`${h}/todos/${e}`,C,{headers:{Authorization:r.value}}),g(),l.value={...l.value,[e]:""}},R=e=>{o.value={...o.value,[e]:!1},l.value={...l.value,[e]:$.value[e]}},U=async e=>{await p.patch(`${h}/todos/${e}/toggle`,{},{headers:{Authorization:r.value}}),g()},T=e=>{f.value=e},f=c("all"),A=E(()=>f.value==="all"?n.value:f.value==="notyet"?n.value.filter(e=>!e.status):f.value==="completed"?n.value.filter(e=>e.status):n.value),F=E(()=>n.value.filter(e=>!e.status).length),L=c(""),q=async()=>{try{await p.post(`${h}/users/sign_out`,{},{headers:{Authorization:r.value}}),L.value="登出成功(｡･∀･)ﾉﾞ",m.fire({icon:"success",title:L.value,showConfirmButton:!1,timer:1500}),y.push("/")}catch(e){L.value="登出失敗(´･Д･)」",m.fire({icon:"error",title:L.value,text:e.response.data.message})}};return(e,s)=>{const C=Q("RouterLink");return u(),i(B,null,[s[8]||(s[8]=t("link",{rel:"stylesheet",href:"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"},null,-1)),t("div",Y,[t("nav",null,[t("h1",null,[t("a",{href:"#",onClick:s[0]||(s[0]=d(()=>{},["prevent"]))},"ONLINE TODO LIST")]),t("ul",null,[t("li",Z,[t("a",{href:"#",onClick:s[1]||(s[1]=d(()=>{},["prevent"]))},[t("span",null,b(z.value.nickname)+"的代辦",1)])]),t("li",null,[S(C,{to:"",class:"formControls_btnLink",onClick:q},{default:V(()=>s[6]||(s[6]=[W("登出")])),_:1})])])]),t("div",ee,[t("div",te,[t("div",se,[N(t("input",{type:"text",placeholder:"請輸入待辦事項","onUpdate:modelValue":s[2]||(s[2]=a=>v.value=a)},null,512),[[O,v.value]]),S(C,{to:"#",class:"formControls_btnLink",onClick:P},{default:V(()=>s[7]||(s[7]=[t("i",{class:"fa fa-plus"},null,-1)])),_:1})]),t("div",ae,[t("ul",oe,[t("li",null,[t("a",{href:"#",class:x({active:f.value==="all"}),onClick:s[3]||(s[3]=d(a=>T("all"),["prevent"]))},"全部 ",2)]),t("li",null,[t("a",{href:"#",class:x({active:f.value==="notyet"}),onClick:s[4]||(s[4]=d(a=>T("notyet"),["prevent"]))},"待完成 ",2)]),t("li",null,[t("a",{href:"#",class:x({active:f.value==="completed"}),onClick:s[5]||(s[5]=d(a=>T("completed"),["prevent"]))},"已完成 ",2)])]),t("div",le,[t("ul",ne,[A.value.length?(u(!0),i(B,{key:0},K(A.value,(a,G)=>(u(),i("li",{key:G},[t("label",ie,[t("input",{class:"todoList_input",type:"checkbox",value:"true",checked:a.status,onChange:_=>U(a.id)},null,40,ue),o.value[a.id]?k("",!0):(u(),i("span",{key:0,class:x(["todo",{complete:a.status}])},b(a.content),3)),o.value[a.id]?N((u(),i("input",{key:1,class:"editinput",type:"text","onUpdate:modelValue":_=>l.value[a.id]=_,placeholder:"請輸入待辦事項(勿空白)"},null,8,re)),[[O,l.value[a.id]]]):k("",!0)]),t("a",ce,[o.value[a.id]?k("",!0):(u(),i("i",{key:0,class:"fa fa-pencil-square-o fa-2x",onClick:d(_=>D(a.id,a.content),["prevent"])},null,8,de)),o.value[a.id]?(u(),i("i",{key:1,class:"fa fa-check fa-2x",onClick:d(_=>I(a.id),["prevent"])},null,8,ve)):k("",!0)]),t("a",fe,[o.value[a.id]?k("",!0):(u(),i("i",{key:0,class:"fa fa-trash fa-2x",onClick:d(_=>j(a.id),["prevent"])},null,8,pe)),o.value[a.id]?(u(),i("i",{key:1,class:"fa fa-times fa-2x",onClick:d(_=>R(a.id),["prevent"])},null,8,he)):k("",!0)])]))),128)):(u(),i("li",_e,"目前尚無待辦事項"))]),t("div",ke,[t("p",null,b(F.value)+" 個待完成項目",1)])])])])])])],64)}}},Ce=X(me,[["__scopeId","data-v-0eea255f"]]);export{Ce as default};
